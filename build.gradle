apply plugin: 'groovy'
apply plugin: 'maven-publish'
apply plugin: 'com.jfrog.bintray'

dependencies {
  compile gradleApi()
  compile localGroovy()
  compile "com.xebialabs.deployit.engine:remote-booter:2014.10-alpha-33"
}

clean.doLast {
  project.delete 'src/test/resources/PetClinic/build'
}

def pomConfig = {
  name 'XL Deploy Gradle Plugin'
  url project_url
  scm { url project_scm }

  organization {
    name 'XebiaLabs'
    url 'http://www.xebialabs.com'
  }
}

publishing {
  publications {
    gradlePlugin(MavenPublication) {
      from components.java

      groupId project_group_id
      artifactId project_artifact_id

      pom.withXml {
        asNode().appendNode('description', project_description)
        asNode().children().last() + pomConfig
      }
    }
  }
}

bintray {
  user = bintrayUsername
  key = bintrayApiKey

  publications = ['gradlePlugin']
  dryRun = false
  publish = false
  pkg {
    repo = 'maven'
    userOrg = 'xebialabs'
    name = project_artifact_id
    desc = project_description
    websiteUrl = project_url
    issueTrackerUrl = project_issues_url
    vcsUrl = project_scm
    licenses = ['Apache-2.0']
    labels = ['deployment', 'deploy', 'xldeploy', 'cd', 'continuous delivery', 'gradle']
    publicDownloadNumbers = true
    version {
      attributes = ['gradle-plugin': "com.xebialabs.xl-deploy:$project_group_id:$project_artifact_id"]
    }
  }
}

repositories {
  mavenLocal()
  maven {
    url "$nexusBaseUrl/repositories/public"
    credentials {
      username nexusUserName
      password nexusPassword
    }
  }
  maven {
    url "$nexusBaseUrl/repositories/releases"
    credentials {
      username nexusUserName
      password nexusPassword
    }
  }
}

buildscript {
  repositories {
    jcenter()
  }
  dependencies {
    classpath 'com.jfrog.bintray.gradle:gradle-bintray-plugin:1.0'
  }
}
